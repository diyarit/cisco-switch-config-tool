name: Build and Release

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: windows-latest
    permissions:
      contents: write

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        pip install tk

    - name: Build executable
      run: |
        pyinstaller --noconfirm --onefile --windowed \
          --add-data "port_configs.json;." \
          --add-data "global_configs.json;." \
          --name "CiscoConfigTool" \
          --icon "NONE" \
          --version-file "version_info.txt" \
          CiscoConfigTool_v5.py

    - name: Create Release
      id: create_release
      uses: softprops/action-gh-release@v1
      with:
        name: Cisco Config Tool ${{ github.ref_name }}
        body: |
          # Cisco Configuration Tool Release ${{ github.ref_name }}
          
          ## What's New
          - Automated release build
          - Windows executable package
          
          ## Installation
          1. Download the executable file
          2. Run the program directly - no installation needed
          
          ## Notes
          - Windows 10/11 compatible
          - No Python installation required
        files: dist/CiscoConfigTool.exe
        draft: false
        prerelease: false
